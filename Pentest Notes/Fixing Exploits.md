**Before running a penetration test, its scope should be defined upfront and the client should accept any potential downtime risks associated with attack vectors. Keeping this in mind, as penetration testers we should always strive to minimize the impact of any exploit we plan to run.**

To avoid potential downtime, instead of firing off a mismatched exploit, we should always read the exploit code carefully, modify it as needed, and test it against our own sandboxed target whenever possible.

**These target-specific variables explain why online resources like the _Exploit Database_[2](https://portal.offsec.com/courses/pen-200-44065/learning/fixing-exploits-45086/fixing-exploits-45123#fn-local_id_130-2) host multiple exploits for the same vulnerability, each written for different target operating system versions and architectures.**

There can also be a benefit to porting an exploit to a different language to take advantage of libraries and features available in that language, and the ability to add it to an attack framework.

## Fixing memory corruption exploits

 The heap is dynamically managed and typically stores large chunks of globally-accessible data, while the stack's purpose is to store local functions' data, and its size is generally fixed.

Rewriting the return address has significant implications because when a function ends, it executes the _ret_[3](https://portal.offsec.com/courses/pen-200-44065/learning/fixing-exploits-45086/fixing-memory-corruption-exploits-45119/buffer-overflow-in-a-nutshell-45091#fn-local_id_330-3) instruction, which loads the return address inside EIP/RIP, the _instruction pointer_ responsible for keeping track of current code instructions.

If an attacker has control over the return address, they may eventually control the program flow as well. Let's examine the exploitation stages for a stack-based buffer overflow attack.

**A typical buffer overflow attack scenario involves overwriting the return address with a JMP ESP instruction, which instructs the program to jump to the stack and execute the shellcode that has been injected right after the beginning of the payload.**

Always review payloads, and preferably replace the payload with your own.  Existing payloads could be malicious or could include bad characters.
Bad characters are _ASCII_ or _UNICODE_ characters that break the application when included in the payload because they might be interpreted as _control characters_.[6](https://portal.offsec.com/courses/pen-200-44065/learning/fixing-exploits-45086/fixing-memory-corruption-exploits-45119/buffer-overflow-in-a-nutshell-45091#fn-local_id_477-6) For example, the null-byte "\x00" is often interpreted as a string terminator and, if inserted in the payload, could prematurely truncate the attack buffer.




